---
layout: post
title:  "redis 获取最新的N个数据."
category: 缓存
tags: redis 获取最新的N个数据
---


##redis 应用场景1->获取最新的N条数据

####
如果项目中有获取最新的文章，或者最新的5000条评论时，可以考虑采用
redis中的List 来做,如果你还有别的需求，可以新建一个keylist，用来
保存你的最新N条记录.
代码简化如下: 这里只贴出了代码片段.

##RedisService.java

```java
	/* List operate. */
	/* LPUSH 操作 获取最新的N条记录.每次只能操作一个元素 */
	public Long lPush(String keyList, String values);

	public Long lPush(byte[] keyList, byte[] values);

	/* start from 0 begin. */
	public void lTrim(byte[] keyList, long start, long end);

	public List<byte[]> lRange(byte[] keyList, long begin, long end);

```
##RedisServiceImpl.java

```java
public Long lPush(final String keyList, final String values) {

		return redisTemplate.execute(new RedisCallback<Long>() {

			public Long doInRedis(RedisConnection connection)
					throws DataAccessException {
				return connection.lPush(
						getStringRedisSerializable().serialize(keyList),
						getStringRedisSerializable().serialize(values));
			}
		});

	}

	public Long lPush(final byte[] keyList, final byte[] values) {
		return redisTemplate.execute(new RedisCallback<Long>() {
			public Long doInRedis(RedisConnection connection)
					throws DataAccessException {
				return connection.lPush(keyList, values);
			}
		});
	}

	public void lTrim(final byte[] keyList, final long start, final long end) {
		redisTemplate.execute(new RedisCallback<Boolean>() {
			public Boolean doInRedis(RedisConnection connection)
					throws DataAccessException {
				connection.lTrim(keyList, start, end);
				return true;
			}
		});

	}

	public List<byte[]> lRange(final byte[] keyList, final long begin,
			final long end) {

		return redisTemplate.execute(new RedisCallback<List<byte[]>>() {

			public List<byte[]> doInRedis(RedisConnection connection)
					throws DataAccessException {
				return connection.lRange(keyList, begin, end);
			}
		});

	}

```



##Test.java

```java

@ContextConfiguration(locations = { "classpath*:applicationContext.xml" })
public class RedisServiceTest extends AbstractJUnit4SpringContextTests {

	@Autowired
	private RedisService redisService;
/*最新的N条记录.*/
	@Test
	public void testLeastN(){
		byte[] keyList = "languelist".getBytes();
		//在原有的基础上存入20条数据.
		for (int i = 0; i < 20; i++) {
			redisService.lPush(keyList, ("id-"+i).getBytes());
		}
		//执行Ltrim 保持languelist里只有10条最新的记录.
		redisService.lTrim(keyList, 0, 9);
		
		//通过Lrange 获取最新的10条记录
		List<byte[]> list = redisService.lRange(keyList, 0, -1);
		if(list!=null&&!list.isEmpty()){
			for (byte[] bs : list) {
				System.out.println(new String(bs));
			}
		}
	}
	
}

```


